<!DOCTYPE html>
<html>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://sdk.amazonaws.com/js/aws-sdk-2.437.0.min.js"></script>
<script>
    // Load the AWS SDK for Node.js
//var AWS = require('aws-sdk');
// Set the region
AWS.config.update({region: 'eu-west-1'});

// Create an SQS service object
var sqs = new AWS.SQS({apiVersion: '2012-11-05'});

var queueURL = "https://sqs.eu-west-1.amazonaws.com/803992687199/orderq";

var params = {
 AttributeNames: [
    "SentTimestamp"
 ],
 MaxNumberOfMessages: 10,
 MessageAttributeNames: [
    "All"
 ],
 QueueUrl: queueURL,
 VisibilityTimeout: 20,
 WaitTimeSeconds: 0
};

function get_request() {
    var table = document.getElementById("orders");

    sqs.receiveMessage(params, function(err, data) {
        if (err) {
            console.log("Receive Error", err);
            setTimeout( get_request, 10000 );
        } else if (data.Messages) {
            console.log(data);
            data.Messages.forEach(element => {
                var order = JSON.parse(element.Body);

                var row = table.insertRow(1);
                var cell1 = row.insertCell(0);
                var cell2 = row.insertCell(1);
                var cell3 = row.insertCell(2);
                var cell4 = row.insertCell(3);
                var cell5 = row.insertCell(4);

                cell1.innerHTML = order.product;
                cell2.innerHTML = order.phone;
                cell3.innerHTML = order.name;
                cell4.innerHTML = order.address;
                cell5.innerHTML = order.time;
            });

            var deleteParams = {
                QueueUrl: queueURL,
                ReceiptHandle: data.Messages[0].ReceiptHandle
            };
            sqs.deleteMessage(deleteParams, function(err, data) {
                if (err) {
                    console.log("Delete Error", err);
                } else {
                    console.log("Message Deleted", data);
                }
            });
            
            setTimeout( get_request, 10000 );
        }
    });
}



function get_products() {
    var table = document.getElementById("products");
    let url = 'https://cg85d9g0eh.execute-api.eu-west-1.amazonaws.com/dev';

    fetch(url, {
        method: 'get'
    }).then(response => response.json())
    .then(response => {
        body = JSON.parse(response.body);
        body.data.Items.forEach(element =>{
            var row = table.insertRow(1);
            var cell1 = row.insertCell(0);
            var cell2 = row.insertCell(1);
            var cell3 = row.insertCell(2);
            var cell4 = row.insertCell(3);
            var cell5 = row.insertCell(4);

            cell1.innerHTML = element.vendorname;
            cell2.innerHTML = element.productname;
            cell3.innerHTML = element.vendor_loc;
            cell4.innerHTML = element.productID;
            cell5.innerHTML = element.vendorID;
        });
    })
    .catch(error => console.error('Error:', error))

}




document.addEventListener('DOMContentLoaded', (event) => {
    //get_request();
    get_products();

})
</script>
<body>
<div style="width:100%;overflow:hidden">
    <div style="width:600px;float:left">
             <!-- PRODUCTS -->
        
    <h1>Products</h1>
    <table style="width:100%" id="products">
        <tr>
            <th>Vendor name</th>
            <th>Product name</th> 
            <th>A</th>
            <th>B</th>
            <th>C</th>
        </tr>
        
        </table>


    </div>
    <div style="margin-left: 901px">
        <h1>Orders</h1>
        <table style="width:100%" id="orders">
                <tr>
                  <th>Product</th>
                  <th>Phone</th> 
                  <th>Name</th>
                  <th>Address</th>
                  <th>Time</th>
                </tr>
                
              </table>
    </div>

   
    
        


</div>
</body>
<footer></footer>
</html>